#!/bin/bash

##
## My system setup script.
##

# consider checking for FDE instead of just enabling it.
# sudo fdesetup enable

echo "Justin's Mac OS X Installation Script"
echo "Install all AppStore apps first"
read -p "Press any key to continue... " -n1 -s
echo  '\n'

echo "Checking to see if Apple Command Line Tools is installed. Will prompt for installation if not."
xcode-select -p
if [[ $? -ne 0 ]]; then
  xcode-select --install
fi

echo Checking Homebrew
if ! hash brew 2>/dev/null; then
  echo "  Installing Homebrew, see /tmp/homebrew-install.log for details"
  ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)" > /tmp/homebrew-install.log
fi

# brew packages
echo "Intalling open source packages view brew, including wget, openssl, rbenv, ruby-build, etc"
brew install openssl libyaml gnutls git tree blueutil gmp imagemagick wget coreutils hub z grc spark
brew link --force openssl

echo "Checking rbenv"
if ! hash rbenv 2>/dev/null; then
  echo "  Installing rbenv"
  brew install rbenv > /tmp/rbenv-install.log
fi

echo "Checking ruby-build"
if ! hash ruby-build 2>/dev/null; then
  echo "  Installing ruby-build"
  brew install ruby-build > /tmp/ruby-build-install.log
fi

# now install two ruby versions required
echo "Installing ruby 1.9.3-p547"
rbenv install -s 1.9.3-p547     # gem install bundler from ~/Projects/progress
rbenv global 1.9.3-p547
gem install bundler

echo "Installing ruby 2.1.2"
rbenv install -s 2.1.2
rbenv global 2.1.2
gem install bundler

echo "Installing homebrew cask"
brew update
brew tap caskroom/cask/brew-cask
brew install brew-cask

echo "Installing core apps and utilities"
brew cask install caffeine dropbox the-unarchiver skype transmission skitch evernote firefox
brew cask install quicksilver keyboard-maestro superduper istat-menus textexpander viscosity fantastical
brew cask install vlc silverlight handbrake mplayerx
brew cask install --appdir="/Applications" google-chrome

echo "Installing games"
brew cask install minecraft steam

echo "Installing editors"
brew cask install textmate bbedit sublime-text atom

echo "Installing development tools"
brew cask install github boot2docker rubymine sourcetree diffmerge heroku-toolbelt postgres

echo "Installing quicklook plugins"
brew cask install qlcolorcode qlstephen qlmarkdown quicklook-json qlprettypatch quicklook-csv betterzipql webp-quicklook 
qlmanage -r

echo "Installing fonts"
brew tap caskroom/fonts
brew cask install font-inconsolata
brew cask install font-source-code-pro

echo "Cleaning up homebrew caches, etc"
brew linkapps
brew cleanup
brew prune
brew cask cleanup

# dot files!
if [[ ! -d ~/.dotfiles ]]; then
  echo Installing tomichj/dotfiles
  git clone https://github.com/tomichj/dotfiles .dotfiles
  ~/.dotfiles/script/bootstrap
  ~/.dotfiles/bin/dot
fi
